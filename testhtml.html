<!DOCTYPE html>
<html>
<body>

<div><img width="1200" src="http://scotch.io/wp-content/uploads/2014/03/node-js-web-scraping-cheerio-request.jpg" class="img-responsive wp-post-image" alt="node-js-web-scraping-cheerio-request" id="article-main-image"><div class="article-content"><p>Before web based API&#x2019;s became the prominent way of sharing data between services we had web scraping. Web scraping is a technique in data extraction where you pull information from websites.</p>\n<p>There are many ways this can be accomplished. It can be done manually by copy and pasting data from a website, using specialized software, or building your own scripts to scrape data. In this tutorial, we will be showing you how to build a <strong>simple web scraper</strong> that gets some general movie information from IMDB. The technologies we will be using to accomplish this are:</p>\n<ul>\n<li><a href="http://nodejs.org/" target="_blank">NodeJS</a></li>\n<li><a href="http://expressjs.com/" target="_blank">ExpressJS</a>: The Node framework that everyone uses and loves.</li>\n<li><a href="https://github.com/mikeal/request" target="_blank">Request</a>: Helps us make HTTP calls</li>\n<li><a href="https://github.com/MatthewMueller/cheerio" target="_blank">Cheerio</a>: Implementation of core jQuery specifically for the server (helps us traverse the DOM and extract data)</li>\n</ul>\n<h2>Setup</h2>\n<p>Our setup will be pretty simple. If you&#x2019;re already familiar with NodeJS, go ahead and setup your project and include <strong>Express</strong>, <strong>Request</strong> and <strong>Cheerio</strong> as your dependencies.</p>\n<p>Here is our <code>package.json</code> file to get all the dependencies we need for our project.</p>\n<pre><code class="language-javascript">// package.json\n\n{\n  "name"         : "node-web-scrape",\n  "version"      : "0.0.1",\n  "description"  : "Scrape le web.",\n  "main"         : "server.js",\n  "author"       : "Scotch",\n  "dependencies" : {\n    "express"    : "latest",\n    "request"    : "latest",\n    "cheerio"    : "latest"\n  }\n}\n</code></pre>\n<p>With your <code>package.json</code> file all ready to go, just install your dependencies with:</p>\n<p><code>npm install</code></p>\n<p>With that setup, let&#x2019;s take a look at what we&#x2019;ll be creating. In this tutorial, we will make a single request to IMDB and get:</p>\n<ul>\n<li>name of a movie</li>\n<li>release year</li>\n<li>IMDB community rating</li>\n</ul>\n<p>Once we compile this information, we will <strong>save it to a JSON file</strong> on our computer. Please see the code examples below for our setup. For this tutorial we will not have a front-end user interface and will rely on our command window to guide us.</p>\n<h2>Our Application</h2>\n<p>Our web scraper is going to be very minimalistic. The basic flow will be as follows:</p>\n<ol>\n<li>Launch web server</li>\n<li>Visit a URL on our server that activates the web scraper</li>\n<li>The scraper will make a request to the website we want to scrape</li>\n<li>The request will capture the HTML of the website and pass it along to our server</li>\n<li>We will traverse the DOM and extract the information we want</li>\n<li>Next, we will format the extracted data into a format we need</li>\n<li>Finally, we will save this formatted data into a JSON file on our machine</li>\n</ol>\n<p>If you&#x2019;ve been following our other NodeJS tutorials you should be pretty familiar with how to structure of an application works. For this tutorial, we will set the entire logic in our <code>server.js</code> file.</p>\n<pre><code class="language-javascript">var express = require(\'express\');\nvar fs = require(\'fs\');\nvar request = require(\'request\');\nvar cheerio = require(\'cheerio\');\nvar app     = express();\n\napp.get(\'/scrape\', function(req, res){\n\n  //All the web scraping magic will happen here\n\n})\n\napp.listen(\'8081\')\n\nconsole.log(\'Magic happens on port 8081\');\n\nexports = module.exports = app;</code>\n</pre>\n<h2>Making the Request</h2>\n<p>Now that we have the boilerplate of the application done, let&#x2019;s get into the fun stuff. We are now on Step 3, and that is <strong>making the request to the external website</strong> we would like to scrape.</p>\n<pre><code class="language-javascript">var express = require(\'express\');\nvar fs = require(\'fs\');\nvar request = require(\'request\');\nvar cheerio = require(\'cheerio\');\nvar app     = express();\n\napp.get(\'/scrape\', function(req, res){\n    // The URL we will scrape from - in our example Anchorman 2.\n\n\turl = \'http://www.imdb.com/title/tt1229340/\';\n\n    // The structure of our request call\n    // The first parameter is our URL\n    // The callback function takes 3 parameters, an error, response status code and the html\n\n\trequest(url, function(error, response, html){\n\n        // First we\'ll check to make sure no errors occurred when making the request\n\n        if(!error){\n            // Next, we\'ll utilize the cheerio library on the returned html which will essentially give us jQuery functionality\n\n            var $ = cheerio.load(html);\n\n            // Finally, we\'ll define the variables we\'re going to capture\n\n\t\t\tvar title, release, rating;\n\t\t\tvar json = { title : "", release : "", rating : ""};\n\t\t}\n\t})\n})\n\napp.listen(\'8081\')\nconsole.log(\'Magic happens on port 8081\');\nexports = module.exports = app;</code>\n</pre>\n<p>The request function takes two parameters, the <code>URL</code> and a <code>callback</code>. For the <strong>URL parameter</strong> we will set the link of the IMDB movie we want to extract information from. In the <strong>callback</strong>, we will capture 3 parameters: <code>error</code>, <code>response</code>, and <code>html</code>.</p>\n<h2>Traversing the DOM</h2>\n<h3>Movie Title</h3>\n<p>Now we are ready to start traversing the DOM and extracting information. First let&#x2019;s get the movie name. We&#x2019;ll head over to IMDB, open up Developer Tools and inspect the movie title element. We will be looking for a <strong>unique element</strong> that will help us single out the movie title. We notice that the <code>&lt;h1&gt;</code> tag is our best bet for the movie title and that the class <code>header</code> is unique. This seems like good starting spot.</p>\n<p><img src="http://scotch.io/wp-content/uploads/2014/03/imdb-dev-tools.png" alt="IMDB DOM Inspect" class="img-responsive img-thumbnail"></p>\n<pre><code class="language-javascript">var express = require(\'express\');\nvar fs = require(\'fs\');\nvar request = require(\'request\');\nvar cheerio = require(\'cheerio\');\nvar app     = express();\n\napp.get(\'/scrape\', function(req, res){\n\t\n\turl = \'http://www.imdb.com/title/tt1229340/\';\n\n\trequest(url, function(error, response, html){\n\t\tif(!error){\n\t\t\tvar $ = cheerio.load(html);\n\n\t\t\tvar title, release, rating;\n\t\t\tvar json = { title : "", release : "", rating : ""};\n\n            // We\'ll use the unique header class as a starting point.\n\n\t\t\t$(\'.header\').filter(function(){\n\n           // Let\'s store the data we filter into a variable so we can easily see what\'s going on.\n\n\t\t        var data = $(this);\n\n           // In examining the DOM we notice that the title rests within the first child element of the header tag. \n           // Utilizing jQuery we can easily navigate and get the text by writing the following code:\n\n\t\t        title = data.children().first().text();\n\n           // Once we have our title, we\'ll store it to the our json object.\n\n\t\t        json.title = title;\n\t        })\n\t\t}\n\t})\n})\n\napp.listen(\'8081\')\nconsole.log(\'Magic happens on port 8081\');\nexports = module.exports = app;</code></pre>\n<h3>Release Year</h3>\n<p>Now we are able to get the <strong>movie title</strong>. Next, we&#x2019;ll repeat the process this time trying to find a unique element in the DOM for the movie release year. We notice that the year is also contained within the <code>&lt;h1&gt;</code> tag and we also notice that the year is contained within the last element of the header. This gives us enough information to extract the year by writing this code:</p>\n<pre><code class="language-javascript">var express = require(\'express\');\nvar fs = require(\'fs\');\nvar request = require(\'request\');\nvar cheerio = require(\'cheerio\');\nvar app     = express();\n\napp.get(\'/scrape\', function(req, res){\n\t\n\turl = \'http://www.imdb.com/title/tt1229340/\';\n\n\trequest(url, function(error, response, html){\n\t\tif(!error){\n\t\t\tvar $ = cheerio.load(html);\n\n\t\t\tvar title, release, rating;\n\t\t\tvar json = { title : "", release : "", rating : ""};\n\n\t\t\t$(\'.header\').filter(function(){\n\t\t        var data = $(this);\n\t\t        title = data.children().first().text();\n            \n                // We will repeat the same process as above.  This time we notice that the release is located within the last element.\n                // Writing this code will move us to the exact location of the release year.\n\n                release = data.children().last().children().text();\n\n\t\t        json.title = title;\n\n                // Once again, once we have the data extract it we\'ll save it to our json object\n\n                json.release = release;\n\t        })\n\t\t}\n\t})\n})\n\napp.listen(\'8081\')\nconsole.log(\'Magic happens on port 8081\');\nexports = module.exports = app;</code></pre>\n<h3>Community Rating</h3>\n<p>Finally, to get the community rating, we repeat the above process. This time though, we notice that there is a very unique class name that will help us get the information really easily. The class name is <code>.star-box-giga-star</code>. So let&#x2019;s write some code to extract that information.</p>\n<pre><code class="language-javascript">var express = require(\'express\');\nvar fs = require(\'fs\');\nvar request = require(\'request\');\nvar cheerio = require(\'cheerio\');\nvar app     = express();\n\napp.get(\'/scrape\', function(req, res){\n\t\n\turl = \'http://www.imdb.com/title/tt1229340/\';\n\n\trequest(url, function(error, response, html){\n\t\tif(!error){\n\t\t\tvar $ = cheerio.load(html);\n\n\t\t\tvar title, release, rating;\n\t\t\tvar json = { title : "", release : "", rating : ""};\n\n\t\t\t$(\'.header\').filter(function(){\n\t\t        var data = $(this);\n\t\t        title = data.children().first().text();\n            \n                release = data.children().last().children().text();\n\n\t\t        json.title = title;\n                json.release = release;\n\t        })\n\n            // Since the rating is in a different section of the DOM, we\'ll have to write a new jQuery filter to extract this information.\n\n            $(\'.star-box-giga-star\').filter(function(){\n\t        \tvar data = $(this);\n\n                // The .star-box-giga-star class was exactly where we wanted it to be.\n                // To get the rating, we can simply just get the .text(), no need to traverse the DOM any further\n\n\t        \trating = data.text();\n\n\t        \tjson.rating = rating;\n\t        })\n\t\t}\n\t})\n})\n\napp.listen(\'8081\')\nconsole.log(\'Magic happens on port 8081\');\nexports = module.exports = app;</code>\n</pre>\n<p>That&#x2019;s all there is to it. If you wanted to extract more information, you can do so by repeating the steps we did above.</p>\n<ol>\n<li>Find a unique element or attribute on the DOM that will help you single out the data you need</li>\n<li>If no unique element exists on the particular tag, find the closest tag that does and set that as your starting point</li>\n<li>If needed, traverse the DOM to get to the data you would like to extract\n</li><li>Extract the data</li>\n</ol>\n<h2>Formatting and Extracting</h2>\n<p>Now that we have the data extracted, let&#x2019;s format it and save it to our project folder. We have been storing our extracted data to a variable called json. Let&#x2019;s save the data in this variable to our project folder. You&#x2019;ll notice earlier that we required the <code>fs</code> library. If you didn&#x2019;t know what this was for, this library gives us access to our computer&#x2019;s file system. Take a look at the code below to see how we write files to the file system.</p>\n<pre><code class="language-javascript">var express = require(\'express\');\nvar fs = require(\'fs\');\nvar request = require(\'request\');\nvar cheerio = require(\'cheerio\');\nvar app     = express();\n\napp.get(\'/scrape\', function(req, res){\n\t\n\turl = \'http://www.imdb.com/title/tt1229340/\';\n\n\trequest(url, function(error, response, html){\n\t\tif(!error){\n\t\t\tvar $ = cheerio.load(html);\n\n\t\t\tvar title, release, rating;\n\t\t\tvar json = { title : "", release : "", rating : ""};\n\n\t\t\t$(\'.header\').filter(function(){\n\t\t        var data = $(this);\n\t\t        title = data.children().first().text();            \n                release = data.children().last().children().text();\n\n\t\t        json.title = title;\n                json.release = release;\n\t        })\n\n            $(\'.star-box-giga-star\').filter(function(){\n\t        \tvar data = $(this);\n\t        \trating = data.text();\n\n\t        \tjson.rating = rating;\n\t        })\n\t\t}\n        // To write to the system we will use the built in \'fs\' library.\n        // In this example we will pass 3 parameters to the writeFile function\n        // Parameter 1 :  output.json - this is what the created filename will be called\n        // Parameter 2 :  JSON.stringify(json, null, 4) - the data to write, here we do an extra step by calling JSON.stringify to make our JSON easier to read\n        // Parameter 3 :  callback function - a callback function to let us know the status of our function\n\n        fs.writeFile(\'output.json\', JSON.stringify(json, null, 4), function(err){\n\n        \tconsole.log(\'File successfully written! - Check your project directory for the output.json file\');\n\n        })\n\n        // Finally, we\'ll just send out a message to the browser reminding you that this app does not have a UI.\n        res.send(\'Check your console!\')\n\t})\n})\n\napp.listen(\'8081\')\nconsole.log(\'Magic happens on port 8081\');\nexports = module.exports = app;</code></pre>\n<p>With this code in place you are set to scrape and save the scraped data.  Let&#x2019;s start up our node server, navigate to <code>http://localhost:8081/scrape</code> and see what happens. </p>\n<ul>\n<li>If everything went smoothly your browser should display a message telling you to check your command prompt.</li>\n<li>When you check your command prompt you should see a message saying that your file was successfully written and that you should check your project folder.</li>\n<li>Once you get to your project folder you should see a new file created called <code>output.json</code>.</li>\n<li>Opening this file, will give you a nicely formatted JSON document that will have the extracted data.</li>\n</ul>\n<p>Congrats! You just wrote your first web scraper!</p>\n<h2>Putting It All Together</h2>\n<p>In this tutorial, we built a simple a web scraper that extracted movie information from an IMBD page. We covered using the Request and Cheerio libraries to make external requests and add jQuery functionality to our NodeJS server. We showed you how to traverse the DOM using jQuery in Node and how to write to the file system. I hope you enjoyed this article. Feel free to ask any questions below.</p>\n<h3 class="text-info">A Note on Web Scraping</h3>\n<p>Web scraping falls within a gray area of the law. Scraping data for personal use within limits is generally ok but you should always get permission from the website owner before doing so. Our example here was very minimalistic in a sense (we only made one request to IMDB) so that it does not interfere with IMDB&#x2019;s operations. Please scrape responsibly.</p>\n\n\t\t\t\n\n\t\t\t\n\n\t\t</div>\n\t</div>

</pre>
</body>
</html>